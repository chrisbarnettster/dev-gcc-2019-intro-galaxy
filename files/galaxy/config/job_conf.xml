<job_conf>
<!-- conf for galaxy-compchem on ilifu, see job_conf.xml.sample_advanced for docs 
     -->
    <plugins workers="4">
        <plugin id="local" type="runner" load="galaxy.jobs.runners.local:LocalJobRunner"/>
        <plugin id="slurm" type="runner" load="galaxy.jobs.runners.slurm:SlurmJobRunner"/>
        <plugin id="cli" type="runner" load="galaxy.jobs.runners.cli:ShellJobRunner" />
    </plugins>
    <destinations default="slurm_ilifu_minimal">
        <destination id="slurm" runner="slurm"/>

        <!-- Templatized destinations - macros can be used to create templated
        destinations with reduced XML duplication. Here we are creating 4 destinations in 4 lines instead of 28 using the macros defined below.
        -->
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_test" ncpus="4" time="1:00:00" partition="Test"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_minimal" ncpus="1" time="1:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_tiny" ncpus="1" time="24:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_xsmall" ncpus="4" time="24:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_small" ncpus="8" time="48:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_medium" ncpus="16" time="72:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_highmem_medium" ncpus="16" time="72:00:00" partition="HighMem"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_highmem_large" ncpus="32" time="72:00:00" partition="HighMem"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_longrunning_medium" ncpus="16" time="144:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_longrunning_large" ncpus="32" time="144:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_gpu" ncpus="1" time="72:00:00" partition="GPU"/>

        <destination id="local" runner="local"/>
    </destinations>
    <tools>
        <tool id="upload1" destination="slurm"/>
        <tool id="testing" destination="slurm_ilifu_test"/>
        <tool id="toolshed.g2.bx.psu.edu/repos/bgruening/ctb_rdkit_descriptors/ctb_rdkit_descriptors/0.6" destination="slurm_ilifu_xsmall"/>
        <tool id="toolshed.g2.bx.psu.edu/repos/chemteam/gmx_fep/gmx_fep/2019.1" destination="slurm_ilifu_medium"/>
    </tools>
    <macros>
        <xml name="slurm_ilifu_destination" tokens="id,time,ncpus,partition">
            <destination id="@ID@" runner="cli">
                <param id="embed_metadata_in_job">False</param>
                <param id="shell_plugin">ParamikoShell</param>
                <param id="job_plugin">Slurm</param>
                <param id="shell_username">cbarnett</param>
                <param id="shell_hostname">slurm.ilifu.ac.za</param>
                <param id="shell_private_key">/home/galaxy/.ssh/id_rsa</param>
                <param id="job_time">@TIME@</param>
                <param id="job_ncpus">@NCPUS@</param>
                <param id="job_partition">@PARTITION@</param>
            </destination>
        </xml>
    </macros>
</job_conf>
