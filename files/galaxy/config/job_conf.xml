<job_conf>
<!-- conf for galaxy-compchem on ilifu, see job_conf.xml.sample_advanced for docs 
     -->
    <plugins workers="4">
        <plugin id="local" type="runner" load="galaxy.jobs.runners.local:LocalJobRunner"/>
        <plugin id="slurm" type="runner" load="galaxy.jobs.runners.slurm:SlurmJobRunner"/>
        <plugin id="cli" type="runner" load="galaxy.jobs.runners.cli:ShellJobRunner" />
    </plugins>
    <destinations default="slurm">
        <destination id="slurm" runner="slurm"/>

        <!-- Templatized destinations - macros can be used to create templated
        destinations with reduced XML duplication. Here we are creating 4 destinations in 4 lines instead of 28 using the macros defined below.
        -->
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_tiny" ncpus="1" time="24:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_xsmall" ncpus="4" time="24:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_small" ncpus="8" time="48:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_medium" ncpus="16" time="72:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_highmem_medium" ncpus="16" time="72:00:00" partition="HighMem"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_highmem_large" ncpus="32" time="72:00:00" partition="HighMem"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_longrunning_medium" ncpus="16" time="144:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_longrunning_large" ncpus="32" time="144:00:00" partition="Main"/>
        <expand macro="slurm_ilifu_destination" id="slurm_ilifu_gpu" ncpus="1" time="72:00:00" partition="GPU"/>

        <destination id="local" runner="local"/>
    </destinations>
    <tools>
        <tool id="upload1" destination="slurm"/>
        <tool id="testing" destination="slurm_ilifu"/>
        <tool id="toolshed.g2.bx.psu.edu/repos/bgruening/ctb_rdkit_descriptors/ctb_rdkit_descriptors/0.6" destination="slurm_ilifu_xsmall"/>
    </tools>
    <limits>
        <!-- Certain limits can be defined. The 'concurrent_jobs' limits all
             control the number of jobs that can be "active" at a time, that
             is, dispatched to a runner and in the 'queued' or 'running'
             states.

             A race condition exists that will allow destination_* concurrency
             limits to be surpassed when multiple handlers are allowed to
             handle jobs for the same destination. To prevent this, assign all
             jobs for a specific destination to a single handler.
        -->
        <!-- registered_user_concurrent_jobs:
                Limit on the number of jobs a user with a registered Galaxy
                account can have active across all destinations.
        -->
        <limit type="registered_user_concurrent_jobs">10</limit>
        <!-- anonymous_user_concurrent_jobs:
                Likewise, but for unregistered/anonymous users.
        -->
        <limit type="anonymous_user_concurrent_jobs">1</limit>
        <!-- destination_user_concurrent_jobs:
                The number of jobs a user can have active in the specified
                destination, or across all destinations identified by the
                specified tag. (formerly: concurrent_jobs)
        -->
        <limit type="destination_user_concurrent_jobs" id="local">1</limit>
        <limit type="destination_user_concurrent_jobs" tag="slurm">2</limit>
        <limit type="destination_user_concurrent_jobs" tag="slurm_ilifu">10</limit>
        <!-- destination_total_concurrent_jobs:
                The number of jobs that can be active in the specified
                destination (or across all destinations identified by the
                specified tag) by any/all users.
        -->
        <limit type="destination_total_concurrent_jobs" id="local">4</limit>
        <limit type="destination_total_concurrent_jobs" tag="slurm_ilifu">100</limit>
        <!-- walltime:
                Amount of time a job can run (in any destination) before it
                will be terminated by Galaxy.
         -->
        <limit type="walltime">48:00:00</limit>
   <!-- total_walltime:
      Total walltime that jobs may not exceed during a set period.
      If total walltime of finished jobs exceeds this value, any
      new jobs are paused.  `window` is a number in days,
      representing the period.
         -->
        <limit type="total_walltime" window="30">48:00:00</limit>
        <!-- output_size:
                Size that any defined tool output can grow to before the job
                will be terminated. This does not include temporary files
                created by the job. Format is flexible, e.g.:
                '10GB' = '10g' = '10240 Mb' = '10737418240'
        -->
        <limit type="output_size">40GB</limit>
    </limits>
    <macros>
        <xml name="slurm_ilifu_destination" tokens="id,time,ncpus,partition">
            <destination id="@ID@" runner="cli">
                <param id="embed_metadata_in_job">False</param>
                <param id="shell_plugin">ParamikoShell</param>
                <param id="job_plugin">Slurm</param>
                <param id="shell_username">cbarnett</param>
                <param id="shell_hostname">slurm.ilifu.ac.za</param>
                <param id="shell_private_key">/home/galaxy/.ssh/id_rsa</param>
                <param id="job_time">@TIME@</param>
                <param id="job_ncpus">@NCPUS@</param>
                <param id="job_partition">@PARTITION@</param>
            </destination>
        </xml>
    </macros>
</job_conf>
